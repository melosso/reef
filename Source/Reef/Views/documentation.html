<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation · Reef</title>
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
    <script src="/assets/js/_tailwind.3.4.17.js"></script>
    <script src="/assets/js/_lucide.0.552.0.js"></script>
    <script src="/assets/js/auth.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/_mermaid.10.9.0.js"></script>
</head>
<body class="bg-slate-50">
    <script>
        requireAuth();
    </script>
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div id="sidebar" class="hidden md:flex md:flex-col md:w-60 bg-slate-800 text-slate-300">
            <div class="flex items-center justify-left px-6 h-16 border-b border-slate-700">
                <i data-lucide="waves" class="h-6 w-6 stroke-blue-400/80"></i>

                <div class="flex items-center ml-3 select-none mt-0.5">
                    <span class="text-slate-100 text-lg font-semibold font-inter tracking-tight">
                    Reef
                    </span>
                    <span class="ml-3 px-3 py-1 rounded border border-slate-700 text-slate-400 text-[10px] uppercase tracking-wide leading-none">
                    beta
                    </span>
                </div>
            </div>

            <nav class="flex-1 px-4 py-4">
                <a href="/dashboard" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 hover:text-slate-100">
                    <i data-lucide="layout-dashboard" class="h-5 w-5"></i>
                    <span class="ml-3">Dashboard</span>
                </a>

                <div class="mt-6">
                    <h3 class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider disable-select">Management</h3>
                    <div class="mt-2 space-y-2">
                        <a href="/connections" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 hover:text-slate-100">
                            <i data-lucide="plug" class="h-5 w-5"></i>
                            <span class="ml-3">Connections</span>
                        </a>
                        <a href="/destinations" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 hover:text-slate-100">
                            <i data-lucide="send" class="h-5 w-5"></i>
                            <span class="ml-3">Destinations</span>
                        </a>
                        <a href="/templates" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 hover:text-slate-100">
                            <i data-lucide="file-text" class="h-5 w-5"></i>
                            <span class="ml-3">Templates</span>
                        </a>
                        <a href="/groups" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 hover:text-slate-100">
                            <i data-lucide="folder" class="h-5 w-5"></i>
                            <span class="ml-3">Groups</span>
                        </a>
                        <a href="/profiles" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 hover:text-slate-100">
                            <i data-lucide="file-code" class="h-5 w-5"></i>
                            <span class="ml-3">Profiles</span>
                        </a>
                    </div>
                </div>

                <div class="mt-6">
                    <h3 class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider disable-select">Automation</h3>
                    <div class="mt-2 space-y-2">
                        <a href="/jobs" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 hover:text-slate-100">
                            <i data-lucide="briefcase" class="h-5 w-5"></i>
                            <span class="ml-3">Jobs</span>
                        </a>
                        <a href="/executions" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 hover:text-slate-100">
                            <i data-lucide="activity" class="h-5 w-5"></i>
                            <span class="ml-3">Executions</span>
                        </a>
                        <a href="/email-approvals" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 hover:text-slate-100">
                            <i data-lucide="check-square" class="h-5 w-5"></i>
                            <span class="ml-3">Approvals</span>
                        </a>
                    </div>
                </div>

                <div class="mt-6">
                    <h3 class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider disable-select">Reference</h3>
                    <div class="mt-2 space-y-2">
                        <a href="/documentation" class="flex items-center px-4 py-3 rounded-lg bg-slate-900 text-slate-100">
                            <i data-lucide="book-open" class="h-5 w-5"></i>
                            <span class="ml-3">Documentation</span>
                        </a>
                    </div>
                </div>
            </nav>

            <!-- User Section with Expandable Menu -->
            <div class="border-t border-slate-700">
                <button onclick="toggleUserMenu()" class="w-full flex items-center justify-between p-4 hover:bg-slate-700/50 transition-colors">
                    <div class="flex items-center space-x-3">
                        <div class="h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center">
                            <span id="user-initial" class="text-white font-bold text-lg">&nbsp;</span>
                        </div>
                        <div class="text-left">
                            <div id="username-display" class="text-slate-100 font-semibold">&nbsp;</div>
                            <div class="text-xs text-slate-400">View menu</div>
                        </div>
                    </div>
                    <i id="chevron-icon" data-lucide="chevron-up" class="h-4 w-4 text-slate-400 transition-transform"></i>
                </button>

                <!-- Expandable Menu -->
                <div id="user-menu" class="overflow-hidden user-menu-collapsed">
                    <div class="px-2 pb-2 space-y-1">
                        <a href="/admin" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 text-slate-300 hover:text-slate-100 transition-colors">
                            <i data-lucide="settings" class="h-4 w-4"></i>
                            <span class="ml-3 text-sm">Settings</span>
                        </a>
                        <a href="https://github.com/melosso/reef" target="_blank" rel="noopener noreferrer" class="flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 text-slate-300 hover:text-slate-100 transition-colors">
                            <i data-lucide="code" class="h-4 w-4"></i>
                            <span class="ml-3 text-sm">GitHub</span>
                            <i data-lucide="external-link" class="h-3 w-3 ml-auto"></i>
                        </a>
                        <button onclick="logout()" class="w-full flex items-center px-4 py-3 rounded-lg hover:bg-slate-700 text-slate-300 hover:text-slate-100 transition-colors">
                            <i data-lucide="log-out" class="h-4 w-4"></i>
                            <span class="ml-3 text-sm">Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-white shadow-sm z-10">
                <div class="flex items-center justify-between px-6 py-4">
                    <h1 class="text-2xl font-semibold text-gray-900 disable-select">Documentation</h1>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto bg-gray-50 p-6">
                <!-- Main Tabs Navigation -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                    <div class="flex border-b border-gray-300">
                        <button onclick="showMainTab('profiles')" id="tab-profiles" class="px-6 py-4 text-blue-600 border-b-2 border-blue-600 hover:bg-blue-50 transition-colors">
                            <div class="flex items-center gap-2">
                                <i data-lucide="file-code" class="h-5 w-5"></i>
                                <span>Profiles</span>
                            </div>
                        </button>
                        <button onclick="showMainTab('jobs')" id="tab-jobs" class="px-6 py-4 text-gray-600 hover:bg-gray-50 hover:text-gray-900 transition-colors">
                            <div class="flex items-center gap-2">
                                <i data-lucide="briefcase" class="h-5 w-5"></i>
                                <span>Jobs</span>
                            </div>
                        </button>
                    </div>

                    <!-- Profiles Tab Content -->
                    <div id="content-profiles" class="tab-content">
                        <!-- View Selection Toolbar -->
                        <div class="bg-gray-50 border-b border-gray-200 px-6 py-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-6">
                                    <div class="flex items-center gap-2 bg-white border border-gray-300 rounded-lg">
                                        <button onclick="showProfileView('overview')" id="tab-profile-overview" class="px-4 py-2 font-medium text-blue-600 border-r border-gray-300 hover:bg-blue-50 transition-colors rounded-l-md">
                                            <div class="flex items-center gap-1">
                                                <i data-lucide="trending-up-down" class="h-4 w-4"></i>
                                                Flowchart
                                            </div>
                                        </button>
                                        <button onclick="showProfileView('relationship')" id="tab-profile-relationship" class="px-4 py-2 font-medium text-gray-600 hover:bg-gray-50 transition-colors rounded-r-md">
                                            <div class="flex items-center gap-1">
                                                <i data-lucide="share-2" class="h-4 w-4"></i>
                                                Relationships
                                            </div>
                                        </button>
                                    </div>
                                    <div class="border-l border-gray-300 pl-6">
                                        <label for="profile-select" class="text-sm font-medium text-gray-700 mr-3">Focus:</label>
                                        <select id="profile-select" onchange="handleProfileSelection()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm inline-block">
                                            <option value="">All Profiles</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="relative group">
                                        <button class="inline-flex items-center gap-1 px-3 py-2 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors" data-tooltip="Download">
                                            <i data-lucide="download" class="h-4 w-4"></i>
                                        </button>
                                        <div class="absolute right-0 mt-0 w-40 bg-white border border-gray-300 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10">
                                            <button onclick="downloadProfileDiagramAsWebP()" data-tooltip="Download as Image" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 first:rounded-t-md">
                                                Image
                                            </button>
                                            <button onclick="downloadProfileDiagramAsMermaid()" data-tooltip="Download as Mermaid" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 last:rounded-b-md border-t border-gray-200">
                                                Mermaid
                                            </button>
                                        </div>
                                    </div>
                                    <button onclick="resetProfileZoom()" class="inline-flex items-center gap-1 px-3 py-2 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors" data-tooltip="Reset zoom">
                                        <i data-lucide="maximize-2" class="h-4 w-4"></i>
                                    </button>
                                    <button onclick="refreshProfileDiagrams()" class="inline-flex items-center gap-1 px-3 py-2 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors" data-tooltip="Refresh">
                                        <i data-lucide="refresh-cw" class="h-4 w-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="text-xs text-gray-500 mt-2">
                                <i data-lucide="zap" class="h-3 w-3 inline mr-1"></i>Drag to pan • Scroll to zoom
                            </div>
                        </div>

                        <!-- Profile diagram container -->
                        <div class="p-6">
                            <div id="profile-diagram-container" class="bg-white border border-gray-200 rounded-lg overflow-auto" style="min-height: 500px; max-height: calc(100vh - 520px);">
                                <div id="profile-diagram" class="mermaid w-full h-full text-white"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Jobs Tab Content -->
                    <div id="content-jobs" class="tab-content hidden">
                        <!-- View Selection Toolbar -->
                        <div class="bg-gray-50 border-b border-gray-200 px-6 py-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-6">
                                    <div class="flex items-center gap-2 bg-white border border-gray-300 rounded-lg">
                                        <button onclick="showJobView('overview')" id="tab-job-overview" class="px-4 py-2 font-medium text-blue-600 border-r border-gray-300 hover:bg-blue-50 transition-colors rounded-l-md">
                                            <div class="flex items-center gap-1">
                                                <i data-lucide="trending-up-down" class="h-4 w-4"></i>
                                                Flowchart
                                            </div>
                                        </button>
                                        <button onclick="showJobView('relationship')" id="tab-job-relationship" class="px-4 py-2 font-medium text-gray-600 hover:bg-gray-50 transition-colors rounded-r-md">
                                            <div class="flex items-center gap-1">
                                                <i data-lucide="share-2" class="h-4 w-4"></i>
                                                Relationships
                                            </div>
                                        </button>
                                    </div>
                                    <div class="border-l border-gray-300 pl-6">
                                        <label for="job-select" class="text-sm font-medium text-gray-700 mr-3">Focus:</label>
                                        <select id="job-select" onchange="handleJobSelection()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm inline-block">
                                            <option value="">All Jobs</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="relative group">
                                        <button class="inline-flex items-center gap-1 px-3 py-2 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors" data-tooltip="Download">
                                            <i data-lucide="download" class="h-4 w-4"></i>
                                        </button>
                                        <div class="absolute right-0 mt-0 w-40 bg-white border border-gray-300 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10">
                                            <button onclick="downloadJobDiagramAsWebP()" data-tooltip="Download as Image" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 first:rounded-t-md">
                                                Image
                                            </button>
                                            <button onclick="downloadJobDiagramAsMermaid()" data-tooltip="Download as Mermaid" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 last:rounded-b-md border-t border-gray-200">
                                                Mermaid
                                            </button>
                                        </div>
                                    </div>
                                    <button onclick="resetJobZoom()" class="inline-flex items-center gap-1 px-3 py-2 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors" data-tooltip="Reset zoom">
                                        <i data-lucide="maximize-2" class="h-4 w-4"></i>
                                    </button>
                                    <button onclick="refreshJobDiagrams()" class="inline-flex items-center gap-1 px-3 py-2 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors" data-tooltip="Refresh">
                                        <i data-lucide="refresh-cw" class="h-4 w-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="text-xs text-gray-500 mt-2">
                                <i data-lucide="zap" class="h-3 w-3 inline mr-1"></i>Drag to pan • Scroll to zoom
                            </div>
                        </div>

                        <!-- Job diagram container -->
                        <div class="p-6">
                            <div id="job-diagram-container" class="bg-white border border-gray-200 rounded-lg overflow-auto" style="min-height: 500px; max-height: calc(100vh - 520px);">
                                <div id="job-diagram" class="mermaid w-full h-full text-white"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Legend</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded" style="background-color: #4F46E5;"></div>
                            <span class="text-sm text-gray-700">Connection</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded" style="background-color: #10B981;"></div>
                            <span class="text-sm text-gray-700">Profile/Job</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded" style="background-color: #8B5CF6;"></div>
                            <span class="text-sm text-gray-700">Transform</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded" style="background-color: #06B6D4;"></div>
                            <span class="text-sm text-gray-700">Destination</span>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        let userMenuExpanded = false;

        function toggleUserMenu() {
            const menu = document.getElementById('user-menu');
            const chevron = document.getElementById('chevron-icon');
            userMenuExpanded = !userMenuExpanded;
            
            if (userMenuExpanded) {
                menu.classList.remove('user-menu-collapsed');
                menu.classList.add('user-menu-expanded');
                chevron.style.transform = 'rotate(180deg)';
            } else {
                menu.classList.remove('user-menu-expanded');
                menu.classList.add('user-menu-collapsed');
                chevron.style.transform = 'rotate(0deg)';
            }
            
            setTimeout(() => queueLucideRender(), 50);
        }

        function logout() {
            clearAuth();
            redirectToLogin();
        }

        queueLucideRender();
    </script>
    <script src="/assets/js/documentation.js"></script>
</body>
</html>
